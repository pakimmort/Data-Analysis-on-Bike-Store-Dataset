-- Top 10 Customer Names Based on Number of Products Purchased
SELECT 
CONCAT(c.first_name, ' ' ,c.last_name) AS Full_Name, SUM(oi.quantity) AS Total_Quantity
FROM 
customers c
JOIN 
orders o ON 
c.customer_id = o.customer_id
JOIN 
order_items oi ON
o.order_id = oi.order_id
GROUP BY 
Full_Name
ORDER BY SUM(oi.quantity) DESC LIMIT 10;

-- Inventory Check: List all products that are currently out of stock (quantity = 0) across all stores.
SELECT p.product_name, SUM(s.quantity) AS Total_quantity 
FROM 
Products p
JOIN 
Stocks s 
ON p.product_id = s.product_id
GROUP BY p.product_name
HAVING Total_quantity = 10;

-- Brand Variety: Count how many different products exist under each brand name.
SELECT b.brand_name, COUNT(p.product_name) AS Total_Products
FROM Brands b
JOIN Products p  
ON p.brand_id = b.brand_id
GROUP BY b.brand_name;

-- Staff Directory: Find the names of all staff members working at a specific store (e.g., Store ID 1).
SELECT CONCAT(s.first_name, ' ', s.last_name) AS Full_Name, st.Store_name, st.store_id
FROM staffs s 
JOIN stores st
ON st.store_id = s.store_id
GROUP BY st.store_id ,Full_Name, st.store_name
HAVING st.store_id = 2;

-- Revenue by Category: Calculate the total revenue generated by each product category. (You'll need to join order_items, products, and categories).
SELECT c.category_name, SUM(p.list_price * quantity) AS Revenue
FROM products p
JOIN categories c 
ON c.category_id = p.category_id
JOIN order_items oi
ON oi.product_id = p.product_id
GROUP BY c.category_name;

-- Store Performance: List each store's name along with the total number of orders processed by that store.
SELECT s.store_name, SUM(oi.quantity) AS orders_processed
FROM stores s 
JOIN orders o
ON o.store_id = s.store_id
JOIN order_items oi
ON oi.order_id = o.order_id
GROUP BY s.store_name;

-- Product Details: Create a report showing Product Name, Brand Name, and Category Name for every product in the database.
SELECT p.product_name, b.brand_name, c.category_name FROM products p
JOIN Brands b
ON b.brand_id = p.brand_id
JOIN Categories c
ON c.category_id = p.category_id
GROUP BY p.product_name, b.brand_name, c.category_name;

-- Missing Sales: Identify products that have never been sold (hint: use a LEFT JOIN and look for NULL order IDs).
SELECT p.product_name, o.order_id
FROM products p
LEFT JOIN order_items o
ON o.product_id = p.product_id
GROUP BY p.product_name,p.prod
HAVING o.order_id = NULL;

-- Monthly Sales Trend: Calculate the total sales amount for each month in the orders table to see if the business is growing.
SELECT year(o.order_date) AS Years, month(o.order_date) AS Months, SUM(oi.list_price * oi.quantity) AS Sales
FROM order_items oi
JOIN orders o
ON o.order_id = oi.order_id
WHERE year(o.order_date) < 2018 AND month(o.order_date) < 8
GROUP BY Years, Months
ORDER BY Years, Months;

-- Top Sellers per Store: For each store, find the top 3 best-selling products by quantity.
SELECT p.product_name, SUM(oi.quantity) AS Sold
FROM Products p
JOIN order_items oi
ON oi.product_id = p.product_id
GROUP BY p.product_name
ORDER BY Sold DESC LIMIT 3;

-- Late Shipments: Find all orders where the shipped_date was later than the required_date
SELECT CONCAT(c.first_name, ' ', c.last_name) AS Customer_name, o.order_id, o.order_date	, o.shipped_date, o.required_date
FROM customers c
JOIN orders o
ON o.customer_id = c.customer_id
WHERE datediff(o.required_date, o.shipped_date) < 0;

-- Duplicate Detection: Check if there are any duplicate customer entries based on email addresses.
SELECT
    customer_id,
    first_name,
    last_name,
    email,
    COUNT(*) OVER (PARTITION BY email) AS email_count
FROM customers;

-- Email List: Create a list of customers who haven't placed an order in the last 6 months for a marketing re-engagement campaign.
SELECT c.customer_id, c.first_name, c.last_name, c.email
FROM Customers c
JOIN orders o
ON o.customer_id = c.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.email
HAVING MAX(o.order_date) < DATE_SUB((SELECT MAX(order_date) FROM orders), INTERVAL 6 MONTH);